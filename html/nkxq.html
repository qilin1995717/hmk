<!DOCTYPE html>
<html>
	<head>
		<title>潮带劲</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

		<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">

		<link rel="stylesheet" href="../lib/weui.min.css">
		<link rel="stylesheet" href="../css/jquery-weui.css">
		<link rel="stylesheet" href="css/demos.css">


		<style>
			.swiper-container {
				width: 100%;
			}
			.swiper-container img {
				display: block;
				width: 100%;
			}
		</style>
	</head>

	<body ontouchstart>

		<div class="swiper-container" style="height: 175px;">
			<!-- Additional required wrapper -->
			<div class="swiper-wrapper">
				<!-- Slides -->
				<div class="swiper-slide"><img id="goods_img" src="images/cdj.png" /></div>
				<!-- <div class="swiper-slide"><img src="./images/swiper-2.jpg" /></div>
				<div class="swiper-slide"><img src="./images/swiper-3.jpg" /></div> -->
			</div>
			<!-- If we need pagination -->
			<div class="swiper-pagination"></div>
		</div>

		<div class="page">
			<a class="weui-cell weui-cell_access" href="javascript:;">
				<div class="weui-cell__bd">
					<h2 id="goods_name" style="font-size: 19px;color: #1A1A1A;margin-bottom: 10px;">潮带劲旅游卡：全家一起潮出游！</h2>
					<div class="jqico" style="display: flex;align-items: center;padding-bottom: 10px;justify-content: space-between;">
						<p><span id="goods_price">￥99 /1年</span><p id="goods_old_price">原价:￥990</p></p>
						<div id="ll">
							销售:15566
						</div>
					</div>
				</div>
			</a>
		</div>
		<div style="height: 50px;display: flex;align-items: center;background:rgba(6,149,255,.1);padding: 0 15px;font-size: 13px;color: #333333;">
			<img src="images/ba4ba5519ae3f2769c825a8c49a83e2.png" style="width: 20%;margin-right: 40px;">
			<span id="goods_end_time">2020年12月30日</span>
		</div>

		<div class="x"></div>
		<div class="tbsm wxts">
			<h2 class="pagebt">温馨提示</h2>
			<ul id="goods_prompt">
				<li>
					1、每个手机微信最多可以绑定5张卡；
				</li>
				<li>
					2、此商品特价，一经购买，不可退换；
				</li>
				<li>
					3、请在使用之前完成本人信息的注册激活；
				</li>
			</ul>
		</div>
		<div class="tbsm syxz">
			<h2 class="pagebt">使用须知</h2>
			<ul id="goods_instructions">
				<li>
					1、微信扫描二维码--关注--注册激活；
				</li>
				<li>
				2、此卡注册激活后立即生效，须至少出游前一天预约；
				</li>
				<li>
				2、此卡注册激活后立即生效，须至少出游前一天预约；
				</li>
			</ul>
		</div>
		<div class="x"></div>
		<div class="yysm tbsm">
			<h2 class="pagebt">
				特别说明
			</h2>
			<ul id="goods_desc">
				<li>
					<span class="yy">
						门票价格：
					</span>
					<span class="nr">
						<p>潮带劲（河南）网络科技有限公司</p>
					</span>
				</li>
				<li>
					<span class="yy">
						门票价格：
					</span>
					<span class="nr">
						<p>潮带劲（河南）网络科技有限公司</p>
					</span>
				</li>
				<li>
					<span class="yy">
						门票价格：
					</span>
					<span class="nr">
						<p>潮带劲（河南）网络科技有限公司</p>
					</span>
				</li>
			</ul>
		</div>
		<div class="jqjs tbsm">
			<h2 class="pagebt">
				景区介绍
			</h2>
			<div class="boxp15" id="goods_details">
				
			</div>
		</div>
		<div style="height: 20px;"></div>
		<div style="position: fixed;bottom: 0;display: flex;justify-content: space-between;align-items: center;width: 100%;background: #FFFFFF;max-width: 750px;">
			<div class="money" style="width: 50%;text-align: center;font-size: 12px;">
				总计：<span style="color: #EC1720;"><b style="font-size: 21px;" id="jage">99</b>/1份</span>
			</div>
			<a href="javascript:;" data-target="#half" class="weui-btn weui-btn_primary open-popup" style="background:linear-gradient(0deg,rgba(42,103,255,1) 0%,rgba(6,149,255,1) 100%);border-radius: 0;width: 50%;display: block;">确定</a>
		</div>
		
		 
		
		<div id="half" class='weui-popup__container popup-bottom'>
		  <div class="weui-popup__overlay"></div>
		  <div class="weui-popup__modal" style="background: #FFFFFF;">
		    <div class="toolbar">
		    </div>
		    <div class="modal-content" style="padding-top: 1rem;">
		      <div class="">
				
				<div class="weui-cell" style="margin-bottom: 15px;">
				  <div class="weui-cell__bd">
				    <p style="color: #1A1A1A;text-align: center;">购买数量</p>
				  </div>
				  <div class="weui-cell__ft">
				    <div class="weui-count">
				      <a class="weui-count__btn weui-count__decrease"></a>
				      <input class="weui-count__number" type="number" value="1" />
				      <a class="weui-count__btn weui-count__increase"></a>
				    </div>
				  </div>
				</div>
				<a href="javascript:;" id="gm" class="weui-btn weui-btn_primary" style="background:linear-gradient(0deg,rgba(42,103,255,1) 0%,rgba(6,149,255,1) 100%);border-radius: 0;
							display: block;width: 100%;max-width: 750px;">确定购买</a>
		      </div>
		    </div>
		  </div>
		</div>
		<script src="../lib/jquery-2.1.4.js"></script>
		<script src="../lib/fastclick.js"></script>
		<script>
			$(function() {
				FastClick.attach(document.body);
			});
		</script>
		<script src="../js/jquery-weui.js"></script>
		<script src="../js/config.js"></script>
		<script>
			$(document).on("open", ".weui-popup-modal", function() {
			  console.log("open popup");
			}).on("close", ".weui-popup-modal", function() {
			  console.log("close popup");
			});
			
			var MAX = 99, MIN = 1;
			$('.weui-count__decrease').click(function (e) {
			  var $input = $(e.currentTarget).parent().find('.weui-count__number');
			  var number = parseInt($input.val() || "0") - 1
			  if (number < MIN) number = MIN;
			  $input.val(number)
			})
			$('.weui-count__increase').click(function (e) {
			  var $input = $(e.currentTarget).parent().find('.weui-count__number');
			  var number = parseInt($input.val() || "0") + 1
			  if (number > MAX) number = MAX;
			  $input.val(number)
			})
			
			$('.delete-swipeout').click(function () {
			  $(this).parents('.weui-cell').remove()
			})
			$('.close-swipeout').click(function () {
			  $(this).parents('.weui-cell').swipeout('close')
			})
			

var sn = getQueryString("sn");

console.log(sn);


$.ajax({
	url:QURL+'/api/card/cardListInfo',
	type:'post',
	dataType:'json',
	data:{
		goods_sn:sn,
	},
	success:function(res){
		console.log(res);
		var data = res.data.list;
		$('#goods_name').text(data.goods_name);
		$('#goods_img').attr("src",data.goods_img);
		$("#goods_price").text("￥"+data.goods_price+"/1年");
		$('#jage').text(data.goods_price);
		$("#goods_old_price").text("原价"+data.goods_old_price);
		$("#goods_end_time").text(data.goods_end_time);
		$("#goods_desc").html(data.goods_desc);
		$("#goods_instructions").html(data.goods_instructions);
		$("#goods_prompt").html(data.goods_prompt);
		$("#goods_details").html(data.goods_details);
		
	}
})
$("#gm").click(function(){
	var sl = $('.weui-count__number').val();
	$.ajax({
		url:QURL+"/api/Wxpay/index",
		type:"post",
		async:false,
		dataType:"json",
		data:{
			token:token,
			goods_sn:sn,
			pay_type:1,
			goods_num:sl,
		},
		success:function(res){
			console.log(sl);
			console.log(res.data.list);
			$.ajax({
				url:QURL+"/api/Wxpay/wxpay",
				type:"post",
				dataType:"json",
				data:{
					token:token,
					order_sn:res.data.list,
				},
				success:function(data){
					var data = data.data.list;
					var data = JSON.parse(data);
					console.log(data);
					console.log(data.package);
					function onBridgeReady(){
					   WeixinJSBridge.invoke(
					      'getBrandWCPayRequest', {
					         "appId":data.appId,     //公众号名称，由商户传入     
					         "timeStamp":data.timeStamp,         //时间戳，自1970年以来的秒数     
					         "nonceStr":data.nonceStr, //随机串     
					         "package":data.package,     
					         "signType":"MD5",         //微信签名方式：     
					         "paySign":data.paySign //微信签名 
					      },
					      function(res){
					      if(res.err_msg == "get_brand_wcpay_request:ok" ){
					      // 使用以上方式判断前端返回,微信团队郑重提示：
						  $.alert("支付成功",function(){
							  window.location.href = 'nklist.html'
						  });
						  
					            //res.err_msg将在用户支付成功后返回ok，但并不保证它绝对可靠。
					      }else{
							  $.alert("失败");
						  }
					   }); 
					}
					if (typeof WeixinJSBridge == "undefined"){
					   if( document.addEventListener ){
					       document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
					   }else if (document.attachEvent){
					       document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
					       document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
					   }
					}else{
					   	onBridgeReady();
					}
					
				}
			})
		},
		
	})
})
		
		
		
		
		
		


		</script>
	</body>
</html>